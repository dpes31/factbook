<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ë¦¬í¬íŠ¸ ë·°ì–´ (Scroll View)</title>
    
    <!-- PPT ìƒì„± ë¼ì´ë¸ŒëŸ¬ë¦¬ (PptxGenJS) -->
    <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>
    <!-- Word ë³€í™˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <!-- í™”ë©´ ìº¡ì²˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ (í•„ìš”ì‹œ ì‚¬ìš©) -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <style>
        /* [ê¸°ë³¸ ì„¤ì •] */
        html, body { width: 100%; height: 100%; margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; display: flex; overflow: hidden; }
        
        /* [ì™¼ìª½] ì—ë””í„° íŒ¨ë„ */
        #editor-pane {
            width: 320px;
            min-width: 300px;
            height: 100%;
            background: #f8f9fa;
            border-right: 1px solid #ddd;
            display: flex;
            flex-direction: column;
            padding: 20px;
            box-sizing: border-box;
            z-index: 20;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        h2 { margin: 0 0 15px 0; font-size: 1.2rem; color: #333; }
        
        .drop-zone {
            border: 2px dashed #bbb;
            border-radius: 6px;
            padding: 20px;
            text-align: center;
            background: white;
            cursor: pointer;
            margin-bottom: 10px;
            font-size: 0.9em;
            color: #666;
            transition: 0.2s;
        }
        .drop-zone:hover { border-color: #007bff; background: #f0f7ff; color: #007bff; }

        textarea {
            flex-grow: 1;
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            resize: none;
            font-family: monospace;
            font-size: 12px;
            margin-bottom: 10px;
            outline: none;
        }
        textarea:focus { border-color: #007bff; }

        .btn-group { display: flex; flex-direction: column; gap: 8px; }
        button {
            padding: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            color: white;
            font-size: 14px;
        }
        .btn-render { background: #007bff; } .btn-render:hover { background: #0056b3; }
        .btn-pdf { background: #6c757d; } .btn-pdf:hover { background: #545b62; }
        .btn-ppt { background: #28a745; } .btn-ppt:hover { background: #1e7e34; }

        .note { font-size: 0.8em; color: #666; margin-top: 15px; background: #eee; padding: 10px; border-radius: 4px; line-height: 1.4; }

        /* [ì˜¤ë¥¸ìª½] ë·°ì–´ íŒ¨ë„ (ìŠ¤í¬ë¡¤ ë·°) */
        #viewer-pane {
            flex-grow: 1;
            height: 100%;
            background: #e0e0e0; /* ë°°ê²½ìƒ‰ êµ¬ë¶„ */
            overflow-y: auto; /* ì„¸ë¡œ ìŠ¤í¬ë¡¤ í—ˆìš© */
            padding: 40px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px; /* ìŠ¬ë¼ì´ë“œ ê°„ ê°„ê²© */
        }

        /* [í•µì‹¬] ê°œë³„ ìŠ¬ë¼ì´ë“œ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .slide-card {
            width: 960px; /* 16:9 ê¸°ì¤€ ë„ˆë¹„ */
            height: 540px; /* 16:9 ê¸°ì¤€ ë†’ì´ */
            background: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            position: relative;
            overflow: hidden; /* ë‚´ìš©ì´ ë„˜ì¹˜ë©´ ìˆ¨ê¹€ (ë‹¨, ì¶•ì†Œí•´ì„œ ë³´ì—¬ì¤„ ì˜ˆì •) */
            flex-shrink: 0;
            transform-origin: top left; /* ì¶•ì†Œ ì‹œ ê¸°ì¤€ì  */
        }

        /* ìŠ¬ë¼ì´ë“œ ë²ˆí˜¸ í‘œì‹œ */
        .slide-number {
            position: absolute;
            top: -25px;
            left: 0;
            color: #666;
            font-weight: bold;
            font-size: 14px;
        }

        /* [ì¤‘ìš”] ì‚¬ìš©ì ì½˜í…ì¸  ê°•ì œ ì¡°ì • CSS (Smart Override) */
        /* ì›ë³¸ ì½”ë“œê°€ ë„ˆë¬´ ê±°ëŒ€í•  ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ í°íŠ¸ ì‚¬ì´ì¦ˆ ê°•ì œ ì¡°ì • */
        .slide-content-wrapper {
            width: 100%;
            height: 100%;
            padding: 40px; /* ë‚´ë¶€ ì—¬ë°± */
            box-sizing: border-box;
            font-size: 10px; /* ê¸°ë³¸ í°íŠ¸ ì‚¬ì´ì¦ˆë¥¼ ì‘ê²Œ ì¡ì•„ì„œ em ë‹¨ìœ„ ëŒ€ì‘ */
            display: flex;
            flex-direction: column;
        }

        /* ì‚¬ìš©ì íƒœê·¸ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™” ë° ì¬ì •ì˜ */
        .slide-content-wrapper section { width: 100%; height: 100%; display: block; }
        .slide-content-wrapper h1 { font-size: 3.5em; margin: 0.5em 0; color: #222; }
        .slide-content-wrapper h2 { font-size: 2.5em; margin: 0.5em 0; color: #333; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
        .slide-content-wrapper h3 { font-size: 1.8em; margin: 0.5em 0; color: #444; }
        .slide-content-wrapper p, .slide-content-wrapper li { font-size: 1.4em; line-height: 1.6; color: #555; }
        .slide-content-wrapper ul { padding-left: 20px; margin: 0; }
        
        /* 2ë‹¨ ë ˆì´ì•„ì›ƒ ëŒ€ì‘ */
        .slide-content-wrapper .two-column { display: flex; gap: 20px; height: 80%; }
        .slide-content-wrapper .column { flex: 1; display: flex; flex-direction: column; }

        /* PDF ì¸ì‡„ìš© ìŠ¤íƒ€ì¼ (ì¸ì‡„ ì‹œì—ë§Œ ì ìš©) */
        @media print {
            #editor-pane { display: none; }
            #viewer-pane { padding: 0; background: white; overflow: visible; display: block; }
            .slide-card { 
                margin: 0; 
                page-break-after: always; /* í•œ ì¥ì”© ëŠì–´ì„œ ì¶œë ¥ */
                box-shadow: none;
                border: 1px solid #eee;
            }
            .slide-number { display: none; }
        }
    </style>
</head>
<body>

    <!-- ì™¼ìª½ ì—ë””í„° -->
    <div id="editor-pane">
        <h2>ğŸ“œ ìŠ¤í¬ë¡¤ ë·°ì–´</h2>
        
        <div id="drop-zone" class="drop-zone">
            íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì„¸ìš”<br>
            (HTML, TXT, DOCX)
            <input type="file" id="file-input" accept=".html,.txt,.docx" style="display:none">
        </div>

        <textarea id="html-input" placeholder="HTML ì½”ë“œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.&#13;&#10;&#13;&#10;[ìˆ˜ì • ì‚¬í•­]&#13;&#10;ì´ì œ ìŠ¬ë¼ì´ë“œê°€ ì˜ë¦¬ì§€ ì•Šê³ &#13;&#10;ì•„ë˜ë¡œ ì­‰ ì´ì–´ì ¸ì„œ ë³´ì…ë‹ˆë‹¤."></textarea>
        
        <div class="btn-group">
            <button class="btn-render" onclick="renderScrollMode()">View (ìƒˆë¡œê³ ì¹¨)</button>
            <button class="btn-pdf" onclick="window.print()">PDF ì €ì¥ (ì¸ì‡„)</button>
            <button class="btn-ppt" onclick="exportPPT()">PPT ë‹¤ìš´ë¡œë“œ</button>
        </div>

        <div class="note">
            <strong>âœ… í•´ê²°ëœ ì :</strong><br>
            â€¢ <strong>ì„¸ë¡œ ìŠ¤í¬ë¡¤:</strong> ì¥í‘œê°€ ì˜ë¦¬ì§€ ì•Šê³  ì•„ë˜ë¡œ ì´ì–´ì§‘ë‹ˆë‹¤.<br>
            â€¢ <strong>ìë™ ì¶•ì†Œ:</strong> ì›ë³¸ ê¸€ì”¨ê°€ ë„ˆë¬´ í¬ë©´ ìë™ìœ¼ë¡œ ë¹„ìœ¨ì„ ë§ì¶°ì„œ ë³´ì—¬ì¤ë‹ˆë‹¤.
        </div>
    </div>

    <!-- ì˜¤ë¥¸ìª½ ë·°ì–´ (ìŠ¤í¬ë¡¤ ëª¨ë“œ) -->
    <div id="viewer-pane">
        <!-- ì—¬ê¸°ì— ìŠ¬ë¼ì´ë“œ ì¹´ë“œë“¤ì´ ìƒì„±ë©ë‹ˆë‹¤ -->
        <div class="slide-card">
            <div class="slide-content-wrapper">
                <div style="display:flex; justify-content:center; align-items:center; height:100%; flex-direction:column; text-align:center;">
                    <h1>í™˜ì˜í•©ë‹ˆë‹¤</h1>
                    <p>ì™¼ìª½ì— ì½”ë“œë¥¼ ë„£ê³  <strong>View</strong> ë²„íŠ¼ì„ ëˆ„ë¥´ë©´<br>ì´ê³³ì— ì¥í‘œê°€ ìˆœì„œëŒ€ë¡œ ë‚˜ì—´ë©ë‹ˆë‹¤.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 1. ë Œë”ë§ í•¨ìˆ˜ (ìŠ¤í¬ë¡¤ ëª¨ë“œ)
        function renderScrollMode() {
            const input = document.getElementById('html-input').value;
            const viewer = document.getElementById('viewer-pane');
            
            if (!input.trim()) { alert("ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }

            // HTML íŒŒì‹±
            const parser = new DOMParser();
            const doc = parser.parseFromString(input, 'text/html');
            
            // <section> íƒœê·¸ ì°¾ê¸°
            const sections = doc.querySelectorAll('section');
            const styles = doc.querySelectorAll('style'); // ì‚¬ìš©ì ìŠ¤íƒ€ì¼ ê°€ì ¸ì˜¤ê¸°

            if (sections.length === 0) {
                // ì„¹ì…˜ì´ ì—†ìœ¼ë©´ ì „ì²´ë¥¼ í•˜ë‚˜ë¡œ ë´„
                viewer.innerHTML = `<div class="slide-card"><div class="slide-content-wrapper">${input}</div></div>`;
                return;
            }

            viewer.innerHTML = ''; // ì´ˆê¸°í™”

            // ì‚¬ìš©ì ìŠ¤íƒ€ì¼ì„ ë·°ì–´ì— ì£¼ì…í•˜ë˜, ë²”ìœ„ ì œí•œ (ì„ íƒì )
            // ì—¬ê¸°ì„œëŠ” ê°„ë‹¨íˆ ê° ìŠ¬ë¼ì´ë“œ ë‚´ë¶€ì— ì ìš©ë˜ë„ë¡ ì²˜ë¦¬í•˜ê±°ë‚˜ ì „ì—­ì— ë„£ìŒ
            // (ì¶©ëŒ ë°©ì§€ë¥¼ ìœ„í•´ ìƒëµí•˜ê±°ë‚˜ í•„ìš”ì‹œ headì— append)

            sections.forEach((sec, index) => {
                // ì¹´ë“œ ì»¨í…Œì´ë„ˆ ìƒì„±
                const cardWrapper = document.createElement('div');
                cardWrapper.style.position = 'relative';

                // ë²ˆí˜¸í‘œ
                const label = document.createElement('div');
                label.className = 'slide-number';
                label.innerText = `Slide ${index + 1}`;
                cardWrapper.appendChild(label);

                // ìŠ¬ë¼ì´ë“œ ì¹´ë“œ
                const card = document.createElement('div');
                card.className = 'slide-card';

                // ë‚´ë¶€ ì½˜í…ì¸  ë˜í¼
                const contentWrapper = document.createElement('div');
                contentWrapper.className = 'slide-content-wrapper';
                
                // [ì¤‘ìš”] ê¸°ì¡´ ë‚´ìš© ì£¼ì…
                contentWrapper.innerHTML = sec.innerHTML;
                
                // ì¹´ë“œì— ë„£ê¸°
                card.appendChild(contentWrapper);
                cardWrapper.appendChild(card);
                
                // ë·°ì–´ì— ì¶”ê°€
                viewer.appendChild(cardWrapper);
            });
        }

        // 2. íŒŒì¼ ì²˜ë¦¬
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        
        dropZone.onclick = () => fileInput.click();
        dropZone.ondragover = (e) => { e.preventDefault(); dropZone.classList.add('dragover'); };
        dropZone.ondragleave = () => dropZone.classList.remove('dragover');
        dropZone.ondrop = (e) => { e.preventDefault(); handleFile(e.dataTransfer.files[0]); };
        fileInput.onchange = (e) => handleFile(e.target.files[0]);

        function handleFile(file) {
            if (!file) return;
            if (file.name.endsWith('.docx')) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    mammoth.convertToHtml({arrayBuffer: e.target.result})
                        .then(res => {
                            // WordëŠ” ì„¹ì…˜ êµ¬ë¶„ì´ ì—†ìœ¼ë¯€ë¡œ ì„ì˜ë¡œ <section>ìœ¼ë¡œ ê°ì‹¸ì¤Œ
                            const rawHtml = res.value;
                            // ê°„ë‹¨íˆ h1, h2 ê¸°ì¤€ìœ¼ë¡œ ë‚˜ëˆ„ê±°ë‚˜ ì „ì²´ë¥¼ í•˜ë‚˜ë¡œ
                            document.getElementById('html-input').value = "<section>" + rawHtml + "</section>";
                            renderScrollMode();
                        })
                        .catch(err => alert(err));
                };
                reader.readAsArrayBuffer(file);
            } else {
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('html-input').value = e.target.result;
                    renderScrollMode();
                };
                reader.readAsText(file);
            }
        }

        // 3. PPT ë‚´ë³´ë‚´ê¸° (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
        function exportPPT() {
            try {
                let pptx = new PptxGenJS();
                pptx.layout = 'LAYOUT_16x9';
                
                // ë·°ì–´ ë‚´ì˜ ëª¨ë“  ìŠ¬ë¼ì´ë“œ ì¹´ë“œ íƒìƒ‰
                const cards = document.querySelectorAll('.slide-content-wrapper');
                
                if(cards.length === 0) { alert("ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."); return; }

                cards.forEach((card, index) => {
                    let slide = pptx.addSlide();
                    let text = card.innerText.replace(/\n\s*\n/g, '\n').trim();
                    
                    slide.background = { color: "FFFFFF" };
                    slide.addText(text, { 
                        x: 0.5, y: 0.5, w: '90%', h: '85%', 
                        fontSize: 14, color: '363636', 
                        align: 'center', valign: 'middle' 
                    });
                    slide.addSlideNumber({ x: '95%', y: '95%', fontSize: 10, color: 'BBBBBB' });
                });

                pptx.writeFile({ fileName: `Report_Slides_${new Date().toISOString().slice(0,10)}.pptx` });
            } catch (error) {
                console.error(error);
                alert("PPT ë³€í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }
        }
    </script>
</body>
</html>
