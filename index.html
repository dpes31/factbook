<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ë¦¬í¬íŠ¸ ë·°ì–´ (Scroll View & Smart Fit)</title>
    
    <!-- PPT ìƒì„± ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>
    <!-- Word ë³€í™˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <!-- í™”ë©´ ìº¡ì²˜ (ì„ íƒ) -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <style>
        /* [ê¸°ë³¸ ì„¤ì •] */
        html, body { width: 100%; height: 100%; margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; display: flex; overflow: hidden; }
        
        /* [ì™¼ìª½] ì—ë””í„° íŒ¨ë„ */
        #editor-pane {
            width: 320px;
            min-width: 300px;
            height: 100%;
            background: #f8f9fa;
            border-right: 1px solid #ddd;
            display: flex;
            flex-direction: column;
            padding: 20px;
            box-sizing: border-box;
            z-index: 20;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        h2 { margin: 0 0 15px 0; font-size: 1.2rem; color: #333; }
        
        .drop-zone {
            border: 2px dashed #bbb;
            border-radius: 6px;
            padding: 20px;
            text-align: center;
            background: white;
            cursor: pointer;
            margin-bottom: 10px;
            font-size: 0.9em;
            color: #666;
            transition: 0.2s;
        }
        .drop-zone:hover { border-color: #007bff; background: #f0f7ff; color: #007bff; }

        textarea {
            flex-grow: 1;
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            resize: none;
            font-family: monospace;
            font-size: 12px;
            margin-bottom: 10px;
            outline: none;
        }
        textarea:focus { border-color: #007bff; }

        .btn-group { display: flex; flex-direction: column; gap: 8px; }
        button {
            padding: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            color: white;
            font-size: 14px;
        }
        .btn-render { background: #007bff; } .btn-render:hover { background: #0056b3; }
        .btn-pdf { background: #6c757d; } .btn-pdf:hover { background: #545b62; }
        .btn-ppt { background: #28a745; } .btn-ppt:hover { background: #1e7e34; }

        .note { font-size: 0.8em; color: #666; margin-top: 15px; background: #eee; padding: 10px; border-radius: 4px; line-height: 1.4; }

        /* [ì˜¤ë¥¸ìª½] ë·°ì–´ íŒ¨ë„ (ìŠ¤í¬ë¡¤ ë·°) */
        #viewer-pane {
            flex-grow: 1;
            height: 100%;
            background: #e0e0e0;
            overflow-y: auto; /* í‰ì†Œì—ëŠ” ìŠ¤í¬ë¡¤ */
            padding: 40px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
        }

        /* [í•µì‹¬] ìŠ¬ë¼ì´ë“œ ì¹´ë“œ í”„ë ˆì„ (960x540 ê³ ì •) */
        .slide-card {
            width: 960px;
            height: 540px;
            background: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            position: relative;
            overflow: hidden; /* ë„˜ì¹˜ëŠ” ë‚´ìš© ìˆ¨ê¹€ (ì¶•ì†Œí•´ì„œ ë³´ì—¬ì¤Œ) */
            flex-shrink: 0;
            margin-bottom: 30px; /* ì¸ì‡„ ì‹œ ê°„ê²© í™•ë³´ */
        }

        /* [Smart-Fit] ë‚´ìš©ë¬¼ ìŠ¤ì¼€ì¼ë§ ë˜í¼ */
        /* ì›ë³¸ì„ ë„“ê²Œ(1280px) ì¡ê³  0.75ë°°ë¡œ ì¶•ì†Œí•˜ì—¬ 960pxì— ë”± ë§ì¶¤ */
        .slide-scaler {
            width: 1280px; /* ë‚´ë¶€ ê°€ìƒ í•´ìƒë„ (ë„“ê²Œ) */
            height: 720px; /* ë‚´ë¶€ ê°€ìƒ ë†’ì´ */
            transform: scale(0.75); /* 1280 * 0.75 = 960 */
            transform-origin: top left;
            background: white;
        }

        .slide-content-wrapper {
            width: 100%;
            height: 100%;
            padding: 50px; /* ë‚´ë¶€ ì—¬ë°± */
            box-sizing: border-box;
            font-size: 16px; /* ì¶•ì†Œë˜ë¯€ë¡œ í°íŠ¸ëŠ” í‚¤ì›€ */
            display: flex;
            flex-direction: column;
            color: #333;
        }

        /* ìŠ¬ë¼ì´ë“œ ë²ˆí˜¸ */
        .slide-number {
            position: absolute;
            top: -25px;
            left: 0;
            color: #666;
            font-weight: bold;
            font-size: 14px;
        }

        /* ì‚¬ìš©ì íƒœê·¸ ìŠ¤íƒ€ì¼ ì¬ì •ì˜ (ë¦¬ì…‹) */
        .slide-content-wrapper section { width: 100%; height: 100%; display: block; }
        .slide-content-wrapper h1 { font-size: 2.8em; margin: 0.3em 0; color: #222; letter-spacing: -1px; }
        .slide-content-wrapper h2 { font-size: 2.2em; margin: 0.3em 0; color: #007bff; border-bottom: 3px solid #007bff; padding-bottom: 10px; }
        .slide-content-wrapper h3 { font-size: 1.6em; margin: 0.5em 0; color: #444; }
        .slide-content-wrapper p, .slide-content-wrapper li { font-size: 1.2em; line-height: 1.6; color: #555; }
        .slide-content-wrapper ul { padding-left: 30px; margin: 10px 0; }
        
        /* 2ë‹¨ ë ˆì´ì•„ì›ƒ ëŒ€ì‘ */
        .slide-content-wrapper .two-column { display: flex; gap: 40px; height: 80%; }
        .slide-content-wrapper .column { flex: 1; display: flex; flex-direction: column; }

        /* [ë¬¸ì œ 1 í•´ê²°] ì¸ì‡„(PDF ì €ì¥) ì „ìš© ìŠ¤íƒ€ì¼ */
        @media print {
            /* ì—ë””í„° ìˆ¨ê¹€ */
            #editor-pane { display: none !important; }
            
            /* ì „ì²´ í˜ì´ì§€ ìŠ¤í¬ë¡¤ í—ˆìš© (í•µì‹¬) */
            html, body {
                height: auto !important;
                overflow: visible !important;
                background: white;
            }

            /* ë·°ì–´ íŒ¨ë„ ìŠ¤íƒ€ì¼ í•´ì œ */
            #viewer-pane {
                width: 100%;
                height: auto !important;
                overflow: visible !important;
                display: block !important;
                padding: 0;
                background: white;
                position: static;
            }

            /* ì¹´ë“œ ìŠ¤íƒ€ì¼: í˜ì´ì§€ ë‚˜ëˆ” ì ìš© */
            .slide-card { 
                margin: 0 auto; 
                margin-bottom: 0;
                page-break-after: always; /* ê° ìŠ¬ë¼ì´ë“œ ë’¤ì—ì„œ í˜ì´ì§€ ë„˜ê¹€ */
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid #eee; /* ì¸ì‡„ ì‹œ í…Œë‘ë¦¬ */
            }
            
            /* ë§ˆì§€ë§‰ í˜ì´ì§€ ê³µë°± ë°©ì§€ */
            .slide-card:last-child { page-break-after: auto; }
            
            .slide-number { display: none; } /* ë²ˆí˜¸ëŠ” ì¸ì‡„ ì•ˆ í•¨ (ì„ íƒ) */
        }
    </style>
</head>
<body>

    <!-- ì™¼ìª½ ì—ë””í„° -->
    <div id="editor-pane">
        <h2>ğŸ“œ ìŠ¤í¬ë¡¤ ë·°ì–´ v2.0</h2>
        
        <div id="drop-zone" class="drop-zone">
            íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì„¸ìš”<br>
            (HTML, TXT, DOCX)
            <input type="file" id="file-input" accept=".html,.txt,.docx" style="display:none">
        </div>

        <textarea id="html-input" placeholder="HTML ì½”ë“œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.&#13;&#10;&#13;&#10;[ì—…ë°ì´íŠ¸ ì™„ë£Œ]&#13;&#10;1. PDF ì €ì¥ ì‹œ ì „ì²´ í˜ì´ì§€ ì¶œë ¥&#13;&#10;2. ìš°ì¸¡ ë‚´ìš© ì˜ë¦¼ ë°©ì§€ (Smart Fit)&#13;&#10;3. PPT ì˜¤ë¥˜ ìˆ˜ì •"></textarea>
        
        <div class="btn-group">
            <button class="btn-render" onclick="renderScrollMode()">View (ìƒˆë¡œê³ ì¹¨)</button>
            <button class="btn-pdf" onclick="window.print()">PDF ì €ì¥ (ì¸ì‡„)</button>
            <button class="btn-ppt" onclick="exportPPT()">PPT ë‹¤ìš´ë¡œë“œ</button>
        </div>

        <div class="note">
            <strong>âœ… ë¬¸ì œ í•´ê²°ë¨:</strong><br>
            â€¢ <strong>PDF:</strong> 'ì¸ì‡„' ì°½ì—ì„œ ì „ì²´ í˜ì´ì§€ê°€ ë³´ì…ë‹ˆë‹¤.<br>
            â€¢ <strong>ì˜ë¦¼ ë°©ì§€:</strong> ë„“ì€ í‘œë‚˜ ê¸€ì”¨ë„ ìë™ìœ¼ë¡œ ì¶•ì†Œë˜ì–´ ê½‰ ì°¨ê²Œ ë³´ì…ë‹ˆë‹¤.<br>
            â€¢ <strong>PPT:</strong> íŠ¹ìˆ˜ë¬¸ì ì˜¤ë¥˜ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.
        </div>
    </div>

    <!-- ì˜¤ë¥¸ìª½ ë·°ì–´ (ìŠ¤í¬ë¡¤ ëª¨ë“œ) -->
    <div id="viewer-pane">
        <div class="slide-card">
            <div class="slide-scaler">
                <div class="slide-content-wrapper">
                    <div style="display:flex; justify-content:center; align-items:center; height:100%; flex-direction:column; text-align:center;">
                        <h1>ì—…ë°ì´íŠ¸ ì™„ë£Œ</h1>
                        <p>ì™¼ìª½ì— ì½”ë“œë¥¼ ë„£ê³  <strong>View</strong> ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.<br>ì´ì œ ìš°ì¸¡ ë‚´ìš©ì´ ì˜ë¦¬ì§€ ì•Šê³ ,<br>PDF ì €ì¥ ì‹œ ëª¨ë“  í˜ì´ì§€ê°€ ë‚˜ì˜µë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 1. ë Œë”ë§ í•¨ìˆ˜ (Smart Fit ì ìš©)
        function renderScrollMode() {
            const input = document.getElementById('html-input').value;
            const viewer = document.getElementById('viewer-pane');
            
            if (!input.trim()) { alert("ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }

            const parser = new DOMParser();
            const doc = parser.parseFromString(input, 'text/html');
            const sections = doc.querySelectorAll('section');
            const styles = doc.querySelectorAll('style'); // ì‚¬ìš©ì ìŠ¤íƒ€ì¼

            // ìŠ¤íƒ€ì¼ ì£¼ì… (í•„ìš”ì‹œ)
            // let cssString = "";
            // styles.forEach(s => cssString += s.innerHTML);

            if (sections.length === 0) {
                // ì„¹ì…˜ ì—†ìœ¼ë©´ í†µì§¸ë¡œ í•˜ë‚˜
                createSlide(viewer, input, 1);
                return;
            }

            viewer.innerHTML = ''; // ì´ˆê¸°í™”

            sections.forEach((sec, index) => {
                createSlide(viewer, sec.innerHTML, index + 1);
            });
        }

        // ìŠ¬ë¼ì´ë“œ ìƒì„± ë„ìš°ë¯¸ (Smart Scaler êµ¬ì¡° ì ìš©)
        function createSlide(container, contentHtml, index) {
            const cardWrapper = document.createElement('div');
            cardWrapper.style.position = 'relative';

            // ë²ˆí˜¸
            const label = document.createElement('div');
            label.className = 'slide-number';
            label.innerText = `Slide ${index}`;
            cardWrapper.appendChild(label);

            // ì¹´ë“œ í”„ë ˆì„ (960x540)
            const card = document.createElement('div');
            card.className = 'slide-card';

            // ìŠ¤ì¼€ì¼ëŸ¬ (1280x720 -> 0.75ë°° ì¶•ì†Œ)
            const scaler = document.createElement('div');
            scaler.className = 'slide-scaler';

            // ì½˜í…ì¸  ë˜í¼
            const contentWrapper = document.createElement('div');
            contentWrapper.className = 'slide-content-wrapper';
            contentWrapper.innerHTML = contentHtml;

            // ì¡°ë¦½
            scaler.appendChild(contentWrapper);
            card.appendChild(scaler);
            cardWrapper.appendChild(card);
            container.appendChild(cardWrapper);
        }

        // 2. íŒŒì¼ ì²˜ë¦¬
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        
        dropZone.onclick = () => fileInput.click();
        dropZone.ondragover = (e) => { e.preventDefault(); dropZone.classList.add('dragover'); };
        dropZone.ondragleave = () => dropZone.classList.remove('dragover');
        dropZone.ondrop = (e) => { e.preventDefault(); handleFile(e.dataTransfer.files[0]); };
        fileInput.onchange = (e) => handleFile(e.target.files[0]);

        function handleFile(file) {
            if (!file) return;
            if (file.name.endsWith('.docx')) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    mammoth.convertToHtml({arrayBuffer: e.target.result})
                        .then(res => {
                            const rawHtml = res.value;
                            document.getElementById('html-input').value = "<section>" + rawHtml + "</section>";
                            renderScrollMode();
                        })
                        .catch(err => alert(err));
                };
                reader.readAsArrayBuffer(file);
            } else {
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('html-input').value = e.target.result;
                    renderScrollMode();
                };
                reader.readAsText(file);
            }
        }

        // 3. PPT ë‚´ë³´ë‚´ê¸° (ë¬¸ì œ 3 í•´ê²°: ì•ˆì •ì„± ê°•í™”)
        function exportPPT() {
            try {
                let pptx = new PptxGenJS();
                pptx.layout = 'LAYOUT_16x9';
                
                // .slide-content-wrapper ì•ˆì˜ í…ìŠ¤íŠ¸ ì¶”ì¶œ
                const cards = document.querySelectorAll('.slide-content-wrapper');
                
                if(cards.length === 0) { 
                    alert("ë³€í™˜í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € View ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”."); 
                    return; 
                }

                // ë¡œë”© ì¤‘ í‘œì‹œ (ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½ ë“±ì€ ìƒëµ)
                
                cards.forEach((card, index) => {
                    let slide = pptx.addSlide();
                    
                    // [ìˆ˜ì •] í…ìŠ¤íŠ¸ ì •ì œ (Sanitization)
                    // null ì²´í¬ ë° íŠ¹ìˆ˜ë¬¸ì ì œê±°ë¡œ ì˜¤ë¥˜ ë°©ì§€
                    let rawText = card.innerText || "";
                    let cleanText = rawText
                        .replace(/[\x00-\x1F\x7F-\x9F]/g, "") // ì œì–´ ë¬¸ì ì œê±°
                        .replace(/\n\s*\n/g, '\n') // ê³¼ë„í•œ ê³µë°± ì¤„ì´ê¸°
                        .trim();
                    
                    if (cleanText.length > 3000) {
                        cleanText = cleanText.substring(0, 3000) + "... (ë‚´ìš©ì´ ë„ˆë¬´ ê¸¸ì–´ ìƒëµë¨)";
                    }

                    // ë°°ê²½ í°ìƒ‰
                    slide.background = { color: "FFFFFF" };
                    
                    // í…ìŠ¤íŠ¸ ì¶”ê°€
                    slide.addText(cleanText, { 
                        x: 0.5, y: 0.5, w: '90%', h: '85%', 
                        fontSize: 14, color: '363636', 
                        align: 'center', valign: 'middle' 
                    });
                    
                    // ìŠ¬ë¼ì´ë“œ ë²ˆí˜¸
                    slide.addSlideNumber({ x: '95%', y: '95%', fontSize: 10, color: 'BBBBBB' });
                });

                pptx.writeFile({ fileName: `Report_Slides_Fixed_${new Date().toISOString().slice(0,10)}.pptx` });
                
            } catch (error) {
                console.error("PPT Error Details:", error);
                alert("PPT ë³€í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\në‚´ìš©ì— ì§€ì›í•˜ì§€ ì•ŠëŠ” íŠ¹ìˆ˜ë¬¸ìê°€ ìˆê±°ë‚˜ ë„ˆë¬´ ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
            }
        }
    </script>
</body>
</html>
